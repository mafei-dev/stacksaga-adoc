<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Aggregator Introduction</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect2">
<h3 id="_aggregator_introduction">Aggregator Introduction</h3>
<div class="paragraph">
<p>Here we are going to discuss how we can create an Aggregator and what are the configurations of the Aggregator.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating_aggregator_class">Creating Aggregator Class</h3>
<div class="paragraph">
<p>The aggregator<sup><a href="#aggregator_architecture">ref</a></sup>  class does represent your business domain, and it is the container for carrying out the data for the executors.
In side of the aggregator class, you should provide all the data regarding your entire transaction.</p>
</div>
<div class="paragraph">
<p>example: Just think you are will be to make a transaction for place and order by using StackSaga. then you have to create an Aggregator class to put the data that you want to while the whole process. you can create an Aggregator class called <code>PlaceOrderAggregator</code> and provide all the data that you want like <em>username, orderId, transactionId</em> etc&#8230;&#8203; and also you might want to add complex data structure inside that aggregate class like <em>list of items</em> regarding the items that the customer&#8217;s order. then you have to create a java pojo as well. as a best practice, the framework suggests you to create all related pojo classes in the same package of the Aggregator class or as the inner classes of the Aggregator class.</p>
</div>
<div class="paragraph">
<p>To be an aggregator in StackSaga, Mainly, The aggregator class should be extended from <code>org.stacksaga.SagaAggregate</code> class and also the aggregator class should be annotated with <code>org.stacksaga.core.annotation.Aggregator</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
All the classes (main aggregator class and other classes that are used inside it) that are used for the SagaAggregator should be implemented by the <code>java.io.Serializable</code> class.
By default, The main aggregator class is Serializable due to the fact that it is implemented from the <code>SagaAggregate</code> class. <a href="#complex_aggrgator">See complex object implementation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s see how it is created in StackSaga project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Aggregator</span>(// <b class="conum">(1)</b>
        version = <span style="color:#007">@AggregatorVersion</span>(major = <span style="color:#00D">1</span>, minor = <span style="color:#00D">0</span>, patch = <span style="color:#00D">1</span>), // <b class="conum">(2)</b>
        idPrefix = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">po</span><span style="color:#710">&quot;</span></span>, // <b class="conum">(3)</b>
        name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PlaceOrderAggregator</span><span style="color:#710">&quot;</span></span>, // <b class="conum">(4)</b>
        sagaSerializable = PlaceOrderAggregatorSample.class // <b class="conum">(5)</b>
)
<span style="color:#007">@Getter</span> // <b class="conum">(6)</b>
<span style="color:#007">@Setter</span> // <b class="conum">(7)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregator</span> <span style="color:#088;font-weight:bold">extends</span> SagaAggregate  { // <b class="conum">(8)</b>

    // <b class="conum">(9)</b>
    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregator() {
        <span style="color:#950">super</span>(PlaceOrderAggregator.class);
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> orderId;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> username;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> isActive;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The aggregator class should be annotated with <code>org.stacksaga.core.annotation.Aggregator</code>.</p>
</li>
<li>
<p><strong>version</strong> will be used for the identification of the aggregator versioning. it is helpful for the <strong>event-upper-casting</strong> and <strong>event-down-casting</strong>. <code>org.stacksaga.core.annotation.AggregatorVersion</code> annotation help you to provide the version of the aggregator.</p>
</li>
<li>
<p><strong>idPrefix</strong> will be used as the prefix of the transaction id. you can give a prefix according to the aggregator name.
The maximum length of the prefix is 4 characters.</p>
</li>
<li>
<p><strong>name</strong> The name of the aggregator. this is used for identification of the aggregator by the name.</p>
</li>
<li>
<p><strong>sagaSerializable</strong> is used for pre-serialization of the samples of the aggregator. <a href="#saga_serializable">see the implementation</a></p>
</li>
<li>
<p><strong>Getter</strong> you can create getters as usual for the aggregator.</p>
</li>
<li>
<p><strong>Setter</strong> you can create setters as usual for the aggregator.</p>
</li>
<li>
<p>The aggregator class should be implemented from the <code>org.stacksaga.SagaAggregate</code> class.
It provides the shep of aggregator in the framework.</p>
</li>
<li>
<p>The aggregator class should have the default constructor and also the <strong>super()</strong> method should be called by passing the same aggregator class.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The name of the aggregator should be the same forever.
Because, all the event-store data is mapped with the aggregator name.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Due to the fact that the aggregator name is configured by an attribute, you can change the package of the aggregator class anytime.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In StackSaga, The aggregator is not a spring bean at all.
Therefore, it is not necessary to have inside the <strong>component scan</strong> area.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="saga_serializable">Creating SagaSerializable Class for Aggregator</h3>
<div class="paragraph">
<p>The <code>SagaSerializable</code> class provides you a method called <code>&lt;T&gt; getSamples()</code> to provide the sample array of objects of your real Aggregator. for each aggregator class that you made should have a separate implementation of <code>SagaSerializable</code> for validating the sample object before the application is started. that process ensures that your aggregator object will not face a serialization error while the transactions are being processed in the production.</p>
</div>
<div class="paragraph">
<p>you can see a sample SagaSerializable <code>(PlaceOrderAggregatorSample.class)</code> implementation of the PlaceOrderAggregator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregatorSample</span> <span style="color:#088;font-weight:bold">implements</span> SagaSerializable&lt;PlaceOrderAggregator&gt; { //<b class="conum">(1)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregator<span style="color:#339;font-weight:bold">[]</span> getSamples() {
        <span style="color:#777">//samples objects for the PlaceOrderAggregator</span>

        <span style="color:#777">//sample-1</span>
        PlaceOrderAggregator aggregator1 = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator1.setOrderId(<span style="color:#0a8;font-weight:bold">UUID</span>.randomUUID().toString());

        <span style="color:#777">//sample-1</span>
        PlaceOrderAggregator aggregator2 = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator2.setOrderId(<span style="color:#0a8;font-weight:bold">UUID</span>.randomUUID().toString());
        aggregator2.setUsername(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mafei</span><span style="color:#710">&quot;</span></span>);

        //<b class="conum">(2)</b>
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator<span style="color:#339;font-weight:bold">[]</span>{
                aggregator1,
                aggregator2,
        };
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Implement your custom <code>PlaceOrderAggregatorSample</code> from the <code>SagaSerializable&lt;T&gt;</code>.
The generic type should be the aggregator that you wish to check the sample object.
According to the example, the Type is <code>PlaceOrderAggregator</code>.
Then you will have a method for providing the sample objects for that given type.</p>
</li>
<li>
<p>Rerun your initialized sample objects by creating a new array for the validation process.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to keep the default constructor for each SagaSerializable implementation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="aggregator_mapper_implementation">Custom Aggregator Mapper</h3>
<div class="paragraph">
<p>You can decide your custom configurations of the objectMapper for your target <a href="#creating_aggregator_class">Aggregator</a>.
By default, the system will use an <a href="https://fasterxml.github.io/jackson-databind/javadoc/2.7/com/fasterxml/jackson/databind/ObjectMapper.html"><code>ObjectMapper</code></a>
that the framework provides for the aggregator serialization and deserialization.
But if you want to customize the objectMapper for your target aggregator, you can create and provide a custom objectMapper object for the target aggregator by using <code>SagaAggregatorMapperProvider</code> implementation.
Then The framework will use the custom Aggregator Mapper that you provided to the target aggregator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The class should be a Spring bean (Annotate with <code>@Component</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here you can see a custom implementation of the <code>AggregatorMapper</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregatorJsonMapper</span> <span style="color:#088;font-weight:bold">implements</span> SagaAggregatorMapperProvider  {//<b class="conum">(2)</b>

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> ObjectMapper objectMapper;

    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregatorJsonMapper() {
        <span style="color:#950">this</span>.objectMapper = <span style="color:#080;font-weight:bold">new</span> ObjectMapper(); //<b class="conum">(3)</b>
        <span style="color:#777">//your custom object mapper configurations</span>
        ...
    }

    //<b class="conum">(4)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> SagaAggregatorMapper getSagaAggregatorMapper() {
        <span style="color:#080;font-weight:bold">return</span> SagaAggregatorMapper.Builder.build(
                <span style="color:#950">this</span>.objectMapper
        );//<b class="conum">(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>@Component</strong>: Mark your custom object mapper implementation as a Spring bean.</p>
</li>
<li>
<p><strong>SagaAggregatorMapperProvider</strong>: Implement by the <code>SagaAggregatorMapperProvider</code> interface.</p>
</li>
<li>
<p>Initialize and set your custom configurations for the <code>objectMapper</code> object that you provide for the target aggregator.</p>
</li>
<li>
<p>Override the method for providing the <code>SagaAggregatorMapper</code> object.</p>
</li>
<li>
<p><strong>SagaAggregatorMapper.Builder</strong>: The builder class provides the methods for building <code>SagaAggregatorMapper</code> object.
you can build <code>SagaAggregatorMapper</code> object by adding your custom configured objectMapper object and return it back.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>SagaAggregatorMapper.Builder</code> class can have several build methods with several mapper types other than the <code>ObjectMapper</code>.
Currently, StackSaga framework only supports <code>ObjectMapper</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can provide your custom object <code>SagaAggregatorMapperProvider</code> class to the target Aggregator like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Aggregator</span>(
        version = <span style="color:#007">@AggregatorVersion</span>(major = <span style="color:#00D">1</span>, minor = <span style="color:#00D">0</span>, patch = <span style="color:#00D">1</span>),
        idPrefix = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">po</span><span style="color:#710">&quot;</span></span>,
        name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PlaceOrderAggregator</span><span style="color:#710">&quot;</span></span>,
        sagaSerializable = PlaceOrderAggregatorSample.class,
        mapper = PlaceOrderAggregatorJsonMapper.class //<b class="conum">(1)</b>
)
<span style="color:#007">@Getter</span>
<span style="color:#007">@Setter</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregator</span> <span style="color:#088;font-weight:bold">extends</span> SagaAggregate {

    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregator() {
        <span style="color:#950">super</span>(PlaceOrderAggregator.class);
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>mapper</strong>: provide your custom aggregator mapper provider class.</p>
</li>
</ol>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="complex_aggrgator">Full Aggregate implementation.</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">//Aggregtor Classs</span>
<span style="color:#007">@Aggregator</span>(
        version = <span style="color:#007">@AggregatorVersion</span>(major = <span style="color:#00D">1</span>, minor = <span style="color:#00D">0</span>, patch = <span style="color:#00D">1</span>),
        idPrefix = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">po</span><span style="color:#710">&quot;</span></span>,
        name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">PlaceOrderAggregator</span><span style="color:#710">&quot;</span></span>,
        sagaSerializable = PlaceOrderAggregatorSample.class
)
<span style="color:#007">@Getter</span>
<span style="color:#007">@Setter</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregator</span> <span style="color:#088;font-weight:bold">extends</span> SagaAggregate {

    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregator() {
        <span style="color:#950">super</span>(PlaceOrderAggregator.class);
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> orderId;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> username;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> isActive;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;ItemDetail&gt; itemDetails = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;&gt;();
}

<span style="color:#777">//Pojo Class for Item Details</span>
<span style="color:#007">@Getter</span>
<span style="color:#007">@Setter</span>
<span style="color:#007">@Builder</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ItemDetail</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> { //<b class="conum">(1)</b>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> itemName;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> qty;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">double</span> price;
}

<span style="color:#777">//Saga Serializable Class</span>
<span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderAggregatorSample</span> <span style="color:#088;font-weight:bold">implements</span> SagaSerializable&lt;PlaceOrderAggregator&gt; {
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> PlaceOrderAggregator<span style="color:#339;font-weight:bold">[]</span> getSamples() {
        <span style="color:#777">//sample-1</span>
        PlaceOrderAggregator aggregator1 = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator1.setOrderId(<span style="color:#0a8;font-weight:bold">UUID</span>.randomUUID().toString());
        <span style="color:#777">//sample-1</span>
        PlaceOrderAggregator aggregator2 = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator2.setOrderId(<span style="color:#0a8;font-weight:bold">UUID</span>.randomUUID().toString());
        aggregator2.setUsername(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mafei</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#777">//sample-3</span>
        PlaceOrderAggregator aggregator3 = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator3.getItemDetails().add(
                ItemDetail
                        .builder()
                        .itemName(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Item-01</span><span style="color:#710">&quot;</span></span>)
                        .price(<span style="color:#60E">10.50</span>)
                        .qty(<span style="color:#00D">2</span>)
                        .build()
        );

        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator<span style="color:#339;font-weight:bold">[]</span>{
                aggregator1,
                aggregator2,
                aggregator3,
        };
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>It is necessary to be implemented by the  <code>Serializable</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="saga_executors">Saga Executors.</h3>
<div class="paragraph">
<p>According to the saga design pattern, sub processes (atomic executions) can have two executions called process execution and compensation execution.
And those executions you van create as the methods in your application anywhere.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong><a href="#query_executor">Query executors</a></strong>: If some atomic process has no compensation (query execution), that kind of process is used in a query executor.</p>
</li>
<li>
<p><strong><a href="#command_executor">Command executors</a></strong>: If some atomic process has a compensation (command execution), that kind of process is used in a command executor.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Revert executors</strong>: For the compensation process of the command executor it can be used other sub processes if you need.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p><strong><a href="#revert_before_executor">Revert Before Executors</a></strong>: If you want to execute an atomic process before executing the main revert process, you can create a Revert-Before-Executor.</p>
</li>
<li>
<p><strong><a href="#revert_after_executor">Revert After Executors</a></strong>: If you want to execute an atomic process after executing the main revert process, you can create a Revert-Before-Executor.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="query_executor">Query Executor.</h4>
<div class="paragraph">
<p>You can create any number of your custom Query-Executors regarding the Aggregator.
Here you can see how you can create a Query-Executor for your <code><a href="#creating_aggregator_class">PlaceOrderAggregator</a></code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// <b class="conum">(1)</b>
<span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user-service</span><span style="color:#710">&quot;</span></span>, // <b class="conum">(2)</b>
        liveCheck = <span style="color:#069">true</span>, // <b class="conum">(3)</b>
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CheckUserExecutor</span><span style="color:#710">&quot;</span></span> // <b class="conum">(4)</b>
)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CheckUserExecutor</span> <span style="color:#088;font-weight:bold">implements</span> QueryExecutor&lt;PlaceOrderAggregator&gt; { // <b class="conum">(5)</b>

    // <b class="conum">(6)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManagerUtil
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {
        <span style="color:#777">//execute the service and check the conndtion.</span>

        <span style="color:#777">//return or throw </span>// <b class="conum">(7)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>@SagaExecutor</strong>: annotate your query executor with <code>@org.stacksaga.annotation.SagaExecutor</code> annotation.
The annotation provides the spring bean capabilities and also another metadata for the StackSaga framework.</p>
</li>
<li>
<p><strong>executeFor</strong>: The name of the service that particular executor is going to be connected. it can be a service name of another service. if the service is spring boot service, make sure to keep the application name as its. because it will be helpful for the retry process.</p>
</li>
<li>
<p><strong>liveCheck</strong>: When the retry process is executed, liveCheck is considered by the engine. if the target service is a spring boot service or registered service with the service registry, the availability is checked before executing the retry by the StackSaga engine.</p>
</li>
<li>
<p><strong>value</strong>: The bean name of the executor.
The executor is identified with this value by StackSaga engine. after configuring the bean name, it cannot be changed at all. if you want to the class package, it does not matter without changing the configured name.</p>
</li>
<li>
<p><strong>QueryExecutor&lt;T&gt;</strong> IF the executor is Query one, The executor should be implemented by <code>org.stacksaga.executor.QueryExecutor&lt;T&gt;</code>. <code>T</code> should be the target Aggregator class for the domain.</p>
</li>
<li>
<p>Override the <code>doProcess()</code>  method and put your execution code block that should be executed when the executor is executed by the StackSaga engine.</p>
</li>
<li>
<p>Finally, you can either return the next executor with the method that provides by the <code>ProcessStepManager</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="command_executor">Command Executor.</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">// <b class="conum">(1)</b>
<span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delivery-service</span><span style="color:#710">&quot;</span></span>, // <b class="conum">(2)</b>
        liveCheck = <span style="color:#069">true</span>, // <b class="conum">(3)</b>
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DispatchOrderExecutor</span><span style="color:#710">&quot;</span></span> // <b class="conum">(4)</b>
)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DispatchOrderExecutor</span> <span style="color:#088;font-weight:bold">implements</span> CommandExecutor&lt;PlaceOrderAggregator&gt; { // <b class="conum">(5)</b>

    // <b class="conum">(6)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack, // <b class="conum">(7)</b>
            PlaceOrderAggregator aggregator, // <b class="conum">(8)</b>
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManager // <b class="conum">(9)</b>
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {
        <span style="color:#777">//execute the service and check the conndtion.</span>
        ...
        <span style="color:#777">//return or throw </span>// <b class="conum">(10)</b>
    }

    <span style="color:#007">@RevertBefore</span>(startFrom = DispatchRevertNotifierExecutor.class)  // <b class="conum">(11)</b>
    <span style="color:#007">@RevertAfter</span>(startFrom = DispatchRevertCompleteLogExecutor.class) // <b class="conum">(12)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> doRevert(
            ProcessStack processStack,// <b class="conum">(13)</b>
            NonRetryableExecutorException nonRetryableExecutorException,// <b class="conum">(14)</b>
            PlaceOrderAggregator aggregator, // <b class="conum">(15)</b>
            RevertHintStore revertHintStore // <b class="conum">(16)</b>
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException {
        <span style="color:#777">//call the atomic process that you want to as the compensation,</span>
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>@SagaExecutor</strong>: annotate your query executor with <code>@org.stacksaga.annotation.SagaExecutor</code> annotation.
The annotation provides the spring bean capabilities and also another metadata for the StackSaga framework.</p>
</li>
<li>
<p><strong>executeFor</strong>: The name of the service that particular executor is going to be connected. it can be a service name of another service. if the service is spring boot service, make sure to keep the application name as its. because it will be helpful for the retry process.</p>
</li>
<li>
<p><strong>liveCheck</strong>: When the retry process is executed, liveCheck is considered by the engine. if the target service is a spring boot service or registered service with the service registry, the availability is checked before executing the retry by the StackSaga engine.</p>
</li>
<li>
<p><strong>value</strong>: The bean name of the executor.
The executor is identified with this value by StackSaga engine. after configuring the bean name, it cannot be changed at all. if you want to the class package, it does not matter without changing the configured name.</p>
</li>
<li>
<p><strong>CommandExecutor&lt;T&gt;</strong> IF the executor is command one, The executor should be implemented by <code>org.stacksaga.executor.CommandExecutor&lt;T&gt;</code>. <code>T</code> should be the target Aggregator class for the domain.</p>
</li>
<li>
<p>Override the <code>doProcess()</code>  method and put your execution code block that should be executed when the executor is executed by the StackSaga engine.</p>
</li>
<li>
<p><strong>ProcessStack</strong> Object provides all the executed execution until the process so far.
It will help for gen an idea about the execution history.
And also you can get the decision of the execution base on the execution history.</p>
</li>
<li>
<p><strong>PlaceOrderAggregator</strong>: The current aggregator state.</p>
</li>
<li>
<p><strong>ProcessStepManagerUtil&lt;T&gt;</strong>: This object provides the methods for giving the navigation to the engine regarding the next step. it can be another executor (command or query) or a process completion.</p>
</li>
<li>
<p>Inside the method scope, you can provide the execution that should be executed when the StackSaga engine executes.
And finally you can navigate to the next step by using the <code>ProcessStepManagerUtil</code> object.</p>
</li>
<li>
<p><strong>@RevertBefore</strong>: If the executor has any revert-before-executors, you can mention that executor class with <code>@RevertBefore</code> annotation.
According to the example, the revert before execution will be started from <a href="#revert_before_executor">DispatchRevertNotifierExecutor</a>.</p>
</li>
<li>
<p><strong>@RevertAfter</strong>: If the executor has any revert-after-executors, you can mention that executor class with <code>@RevertAfter</code> annotation.
According to the example, the revert after execution will be started from <a href="#revert_after_executor">DispatchRevertCompleteLogExecutor</a>.</p>
</li>
<li>
<p><strong>ProcessStack</strong> The final process stack that was when the final execution was executed.</p>
</li>
<li>
<p><strong>NonRetryableExecutorException</strong> The exception that caused the transition process stopping to forward.</p>
</li>
<li>
<p><strong>PlaceOrderAggregator</strong> The final aggregator state when the NonRetryableExecutorException is thrown.</p>
</li>
<li>
<p><strong>RevertHintStore</strong> If you want to add some data to the backward process, you can use the <code>RevertHintStore</code> to put the data.</p>
</li>
</ol>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="revert_before_executor">Revert Before Executor.</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//<b class="conum">(1)</b>
<span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delivery-service</span><span style="color:#710">&quot;</span></span>,//<b class="conum">(2)</b>
        liveCheck = <span style="color:#069">true</span>,//<b class="conum">(3)</b>
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DispatchRevertNotifierExecutor</span><span style="color:#710">&quot;</span></span> //<b class="conum">(4)</b>
)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DispatchRevertNotifierExecutor</span> <span style="color:#088;font-weight:bold">implements</span> RevertBeforeExecutor&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; {//<b class="conum">(5)</b>

    //<b class="conum">(6)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> RevertBeforeStepManager&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; doProcess(
            PlaceOrderAggregator aggregator,//<b class="conum">(7)</b>
            ProcessStack previousProcessStack,//<b class="conum">(8)</b>
            NonRetryableExecutorException processException,//<b class="conum">(9)</b>
            RevertHintStore revertHintStore,//<b class="conum">(10)</b>
            RevertBeforeStepManagerUtil&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; revertStepManagerUtil //<b class="conum">(11)</b>
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException { //<b class="conum">(12)</b>
        <span style="color:#080;font-weight:bold">return</span> revertStepManagerUtil.next(NextBeforExecutor.class); //<b class="conum">(13)</b>
        <span style="color:#777">//or</span>
        <span style="color:#080;font-weight:bold">return</span> revertStepManagerUtil.complete(); //<b class="conum">(14)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>@SagaExecutor</strong>: annotate your query executor with <code>@org.stacksaga.annotation.SagaExecutor</code> annotation.
The annotation provides the spring bean capabilities and also another metadata for the StackSaga framework.</p>
</li>
<li>
<p><strong>executeFor</strong>: The name of the service that particular executor is going to be connected. it can be a service name of another service. if the service is spring boot service, make sure to keep the application name as its. because it will be helpful for the retry process.</p>
</li>
<li>
<p><strong>liveCheck</strong>: When the retry process is executed, liveCheck is considered by the engine. if the target service is a spring boot service or registered service with the service registry, the availability is checked before executing the retry by the StackSaga engine.</p>
</li>
<li>
<p><strong>value</strong>: The bean name of the executor.
The executor is identified with this value by StackSaga engine. after configuring the bean name, it cannot be changed at all. if you want to the class package, it does not matter without changing the configured name.</p>
</li>
<li>
<p><strong>RevertBeforeExecutor&lt;A, E&gt;</strong>: The Revert Before Executor should be implemented from the <code>RevertBeforeExecutor&lt;A,E&gt;</code>.
Generic <strong>A</strong> is the aggregator.
Generic <strong>E</strong> is the <a href="#command_executor">command-executor</a> of the given aggregator as the Generic <strong>A</strong>.</p>
</li>
<li>
<p>Override the <code>doProcess()</code> method that <code>RevertBeforeExecutor</code> provides.
That is the method is executed by the StackSaga engine.</p>
</li>
<li>
<p><strong>PlaceOrderAggregator</strong>: The final aggregator state when the process exception is thrown.</p>
</li>
<li>
<p><strong>ProcessStack</strong>: The final process stack when the process exception is thrown.</p>
</li>
<li>
<p><strong>NonRetryableExecutorException</strong>:The process-exception that was thrown by the last executor.</p>
</li>
<li>
<p><strong>RevertHintStore</strong> If you want to add some data to the backward process, you can use the <code>RevertHintStore</code> to put the data as container.</p>
</li>
<li>
<p><strong>RevertBeforeStepManagerUtil&lt;A, E&gt;</strong>: This object provides the methods for giving the navigation to the engine regarding the next step. it can be another revert-before-executor or a revert-before completion.</p>
</li>
<li>
<p><strong>RetryableExecutorException</strong>: If the revert before execution is failed due to a retryable exception, you can provide that by warping with <code>RetryableExecutorException</code>.</p>
</li>
<li>
<p><strong>next()</strong>: You can provide (only if you have) the next revert-before-executor with <code>revertStepManagerUtil.next()</code>.</p>
</li>
<li>
<p><strong>complete()</strong>: If you don&#8217;t have any revert-before-executor to be executed as next regarding the command-executor, you can return <code>revertStepManagerUtil.complete()</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="revert_after_executor">Revert After Executor.</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">//<b class="conum">(1)</b>
<span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delivery-service</span><span style="color:#710">&quot;</span></span>,//<b class="conum">(2)</b>
        liveCheck = <span style="color:#069">true</span>,//<b class="conum">(3)</b>
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DispatchRevertNotifierExecutor</span><span style="color:#710">&quot;</span></span> //<b class="conum">(4)</b>
)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DispatchRevertCompleteLogExecutor</span> <span style="color:#088;font-weight:bold">implements</span> RevertAfterExecutor&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; {//<b class="conum">(5)</b>

    //<b class="conum">(6)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> RevertAfterStepManager&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; doProcess(
            PlaceOrderAggregator aggregator,//<b class="conum">(7)</b>
            ProcessStack previousProcessStack,//<b class="conum">(8)</b>
            NonRetryableExecutorException processException,//<b class="conum">(9)</b>
            RevertHintStore revertHintStore,//<b class="conum">(10)</b>
            RevertAfterStepManagerUtil&lt;PlaceOrderAggregator, DispatchOrderExecutor&gt; revertStepManagerUtil //<b class="conum">(11)</b>
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException { //<b class="conum">(12)</b>
        <span style="color:#080;font-weight:bold">return</span> revertStepManagerUtil.next(NextAfterExecutor.class); //<b class="conum">(13)</b>
        <span style="color:#777">//or</span>
        <span style="color:#080;font-weight:bold">return</span> revertStepManagerUtil.complete(); //<b class="conum">(14)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>@SagaExecutor</strong>: annotate your query executor with <code>@org.stacksaga.annotation.SagaExecutor</code> annotation.
The annotation provides the spring bean capabilities and also another metadata for the StackSaga framework.</p>
</li>
<li>
<p><strong>executeFor</strong>: The name of the service that particular executor is going to be connected. it can be a service name of another service. if the service is spring boot service, make sure to keep the application name as its. because it will be helpful for the retry process.</p>
</li>
<li>
<p><strong>liveCheck</strong>: When the retry process is executed, liveCheck is considered by the engine. if the target service is a spring boot service or registered service with the service registry, the availability is checked before executing the retry by the StackSaga engine.</p>
</li>
<li>
<p><strong>value</strong>: The bean name of the executor.
The executor is identified with this value by StackSaga engine. after configuring the bean name, it cannot be changed at all. if you want to the class package, it does not matter without changing the configured name.</p>
</li>
<li>
<p><strong>RevertAfterExecutor&lt;A, E&gt;</strong>: The Revert After Executor should be implemented from the <code>RevertAfterExecutor&lt;A,E&gt;</code>.
Generic <strong>A</strong> is the aggregator.
Generic <strong>E</strong> is the <a href="#command_executor">command-executor</a> of the given aggregator as the Generic <strong>A</strong>.</p>
</li>
<li>
<p>Override the <code>doProcess()</code> method that <code>RevertAfterExecutor</code> provides.
That is the method is executed by the StackSaga engine.</p>
</li>
<li>
<p><strong>PlaceOrderAggregator</strong>: The final aggregator state when the process exception is thrown.</p>
</li>
<li>
<p><strong>ProcessStack</strong>: The final process stack when the process exception is thrown.</p>
</li>
<li>
<p><strong>NonRetryableExecutorException</strong>:The process-exception that was thrown by the last executor.</p>
</li>
<li>
<p><strong>RevertHintStore</strong> If you want to add some data to the backward process, you can use the <code>RevertHintStore</code> to put the data as container.</p>
</li>
<li>
<p><strong>RevertAfterStepManagerUtil&lt;A, E&gt;</strong>: This object provides the methods for giving the navigation to the engine regarding the next step. it can be another revert-after-executor or a revert-after completion.</p>
</li>
<li>
<p><strong>RetryableExecutorException</strong>: If the revert after execution is failed due to a retryable exception, you can provide that by warping with <code>RetryableExecutorException</code>.</p>
</li>
<li>
<p><strong>next()</strong>: You can provide (only if you have) the next revert-after-executor with <code>revertStepManagerUtil.next()</code>.</p>
</li>
<li>
<p><strong>complete()</strong>: If you don&#8217;t have any revert-after-executor to be executed as next regarding the command-executor, you can return <code>revertStepManagerUtil.complete()</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processstack">ProcessStack</h3>

</div>
<div class="sect2">
<h3 id="retryable_executor_exception">RetryableExecutorException</h3>
<div class="paragraph">
<p>If you are having an exception while processing the executor due to a connection issue or that kind of re-invokable error (The exceptions that can be occurred temporarily), you can throw a <code>RetryableExecutorException</code>.
Then the StackSaga engine will temporarily pause the execution, and the transaction does expose to the next scheduler.
Because, the engine knows that even though the executor has an exception at this moment, the execution can be retried and run again successfully due to the retractable error.
IF you were unable to catch the exception properly, the execution might throw <code>RuntimeException</code> s.
That kind of unhandled exception will be caught as non-retryable exception by the StackSaga engine.
IF the exception is a <strong>non-retryable</strong> error, you can throw it by warping with <a href="#non_retryable_executor_exception"><code>NonRetryableExecutorException</code></a>.</p>
</div>
<div class="paragraph">
<p><strong>Retryable Executor Exceptions</strong> are allowed for the following executors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Executor</th>
<th class="tableblock halign-left valign-top">DoProcess() Method</th>
<th class="tableblock halign-left valign-top">doRevert() Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revert Before Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revert After Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is very important to identify whether the exception is a retryable exception or not.
If you don&#8217;t identify the exceptions that are thrown when the execution is executed every time that an exception is thrown, the transaction will be stopped to forward.
Therefore, it is necessary to capture and identify all the exceptions that are thrown inside the <code>doProcess()</code> method.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user-service</span><span style="color:#710">&quot;</span></span>,
        liveCheck = <span style="color:#069">true</span>,
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CheckUserExecutor</span><span style="color:#710">&quot;</span></span>
)
<span style="color:#007">@AllArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CheckUserExecutor</span> <span style="color:#088;font-weight:bold">implements</span> QueryExecutor&lt;PlaceOrderAggregator&gt; {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> UserService userService;
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManagerUtil
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {

        <span style="color:#080;font-weight:bold">try</span> {

            ResponseEntity&lt;UserDetailDto&gt; userDetail = <span style="color:#950">this</span>.userService.getUserDetail(aggregator.getUsername());
            ...
        } <span style="color:#080;font-weight:bold">catch</span> (FeignException.ServiceUnavailable unavailableException) {
            <span style="color:#080;font-weight:bold">throw</span> RetryableExecutorException.buildWith(unavailableException).build();
        }
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="non_retryable_executor_exception">NonRetryableExecutorException</h3>
<div class="paragraph">
<p>If you are having an exception while processing the executor that is not temporally occurred (The exceptions that have not any point of executing again), you can throw a <code>NonRetryableExecutorException</code>.
Then the StackSaga engine will stop the execution forward, and start reverting back, according to the configuration.</p>
</div>
<div class="paragraph">
<p>IF you were unable to catch the exception properly, the execution might throw <code>RuntimeException</code> s.
That kind of unhandled exception will be caught as <strong>non-retryable</strong> exception by the StackSaga engine as well.
But if you want to have proper error handling, you have to catch exceptions properly.</p>
</div>
<div class="paragraph">
<p><strong>Non-Retryable Executor Exceptions</strong> are allowed for the following executors.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Executor</th>
<th class="tableblock halign-left valign-top">DoProcess() Method</th>
<th class="tableblock halign-left valign-top">doRevert() Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✖</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✔</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✖</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revert Before Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✖</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revert After Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✖</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can see in the summary table, all the revert executions are not allowed <code>NonRetryableExecutorException</code> s.
The reason for that is according to the StackSaga architecture, any <strong>command-execution</strong> can have revert execution (compensation execution).
But all the <strong>revert-executions</strong> can have retryable-exception only.
Because, even though the process can be failed, the revert execution cannot be failed at all.
If the process is failed, there is a revert execution to have a compensation.
But if the revert is failed, there are any other executions to have compensation for the reverting fail.<br>
<strong>The summary is that only forward execution can have non-retryable-exception.</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user-service</span><span style="color:#710">&quot;</span></span>,
        liveCheck = <span style="color:#069">true</span>,
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CheckUserExecutor</span><span style="color:#710">&quot;</span></span>
)
<span style="color:#007">@AllArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CheckUserExecutor</span> <span style="color:#088;font-weight:bold">implements</span> QueryExecutor&lt;PlaceOrderAggregator&gt; {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> UserService userService;

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManagerUtil
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {

        <span style="color:#080;font-weight:bold">try</span> {

            ResponseEntity&lt;UserDetailDto&gt; userDetail = <span style="color:#950">this</span>.userService.getUserDetail(aggregator.getUsername());
            ...
        } <span style="color:#080;font-weight:bold">catch</span> (FeignException.ServiceUnavailable unavailableException) {
            <span style="color:#080;font-weight:bold">throw</span> RetryableExecutorException
                    .buildWith(unavailableException)
                    .build();
        } <span style="color:#080;font-weight:bold">catch</span> (FeignException.BadRequest badRequestException) {
            //<b class="conum">(1)</b>
            <span style="color:#080;font-weight:bold">throw</span> NonRetryableExecutorException
                    .buildWith(badRequestException)
                    .put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">time</span><span style="color:#710">&quot;</span></span>, LocalDateTime.now())  //<b class="conum">(2)</b>
                    .put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reason</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">BadRequest</span><span style="color:#710">&quot;</span></span>) //<b class="conum">(2)</b>
                    ...
                    .build();
        }
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>NonRetryableExecutorException</strong> is thrown due to the exception is a <code>BadRequest</code>. specially <code>NonRetryableExecutorException</code> provides a way to add the metadata regarding the exception.</p>
</li>
<li>
<p>Put the metadata regarding exception as a key and value. <a id="stacksaga_exception_wrapping"></a></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In java, we usually pass the data regarding the exception with the exception object.
But in the StackSaga it is <strong>not recommended</strong>.
Because, any time any object can be serialized (even Exceptions) for saving to the event-store.
Serializing an exception object (like Json or XML) is not easy, and it might be a performance issue without any benefit.
And also most of the time if you pass a complex exception, it might throw an exception when it is serialized.
Therefore, StackSaga engine just saves your exception as a string in the event-store(Only for seeing through the Admin-Dashboard).
If you want to put some metadata to the backward regarding the exception,
<strong>NonRetryableExecutorException</strong> has a method to put the data as key and value pare called <code>put(key, value)</code>.
You can put any number of key/value pare into that by using the put method.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
There is nothing like you can throw an exception when some exception is occurred.
If you don&#8217;t want to continue the execution of the transaction to forward, and if you decide that the transaction should be stopped at some point, due to a condition is not met, you can throw a <strong>NonRetryableExecutorException</strong> exception as well.
<a href="#usage_of_exceptions">See the full implementation</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="usage_of_exceptions">Usage of Executors[Q&amp;C] With Exceptions </h3>
<div class="paragraph">
<p>Here you can see how you can handle the <strong>success</strong>,
<strong>failure</strong> and <strong>retryable</strong> scenario inside the <strong><a href="#query_executor">query-executor</a></strong> executor.
In the same way, you can handle all things in <strong><a href="#command_executor">command-executor</a></strong> as well.</p>
</div>
<div class="paragraph">
<p>Create your own exception annotating with <code><a href="#saga_exception_annotation">@SagaException</a></code>  class to handle to inactive user exception.</p>
</div>
<div class="paragraph">
<p>The executor gets the userdata from the user-service by calling another service.
Based on the return of the <code>userService.getUserDetail</code>  method, the next step is managed here.
If the user is in active mode, The current executor allows the next executor by providing the next executor that should be invoked to the StackSaga engine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user-service</span><span style="color:#710">&quot;</span></span>,
        liveCheck = <span style="color:#069">true</span>,
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CheckUserExecutor</span><span style="color:#710">&quot;</span></span>
)
<span style="color:#007">@AllArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CheckUserExecutor</span> <span style="color:#088;font-weight:bold">implements</span> QueryExecutor&lt;PlaceOrderAggregator&gt; {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> UserService userService;

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManagerUtil
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {

        <span style="color:#080;font-weight:bold">try</span> {
            ResponseEntity&lt;UserDetailDto&gt; userDetail = <span style="color:#950">this</span>.userService.getUserDetail(aggregator.getUsername());
            <span style="color:#080;font-weight:bold">if</span> (userDetail.getBody().getIsActive() == <span style="color:#00D">1</span>) {
                <span style="color:#080;font-weight:bold">return</span> stepManagerUtil.next(DispatchOrderExecutor.class); //<b class="conum">(1)</b>
            } <span style="color:#080;font-weight:bold">else</span> {
                UserInactiveException inactiveException = <span style="color:#080;font-weight:bold">new</span> UserInactiveException(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">User is not active!</span><span style="color:#710">&quot;</span></span>); //<b class="conum">(2)</b>
                <span style="color:#080;font-weight:bold">throw</span> NonRetryableExecutorException
                        .buildWith(inactiveException)
                        .build();
            }
        } <span style="color:#080;font-weight:bold">catch</span> (FeignException.ServiceUnavailable unavailableException) {
            <span style="color:#080;font-weight:bold">throw</span> RetryableExecutorException
                    .buildWith(unavailableException)
                    .build(); //<b class="conum">(3)</b>
        } <span style="color:#080;font-weight:bold">catch</span> (FeignException.BadRequest badRequestException) {
            <span style="color:#080;font-weight:bold">throw</span> NonRetryableExecutorException
                    .buildWith(badRequestException)
                    .put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, LocalDateTime.now())
                    .put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reason</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">BadRequest</span><span style="color:#710">&quot;</span></span>)
                    .build(); //<b class="conum">(4)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>Success scenario</strong>:
If the user is active, the next executor will be provided to the engine by using <code>stepManagerUtil.next()</code> method.</p>
</li>
<li>
<p><strong>Failed scenario</strong>:
IF the user is inactive, the process is stopped to forward by throwing <code>NonRetryableExecutorException</code> with <code>UserInactiveException</code>.</p>
</li>
<li>
<p><strong>Failed scenario</strong>:
IF the <code>userService.getUserDetail()</code> service throw a <code>FeignException.BadRequest</code> exception, the process is stopped to forward by throwing <code>NonRetryableExecutorException</code> with <code>FeignException.BadRequest</code> that occurred.</p>
</li>
<li>
<p><strong>Retryable scenario</strong>
IF the <code>userService.getUserDetail()</code> service throw a <code>FeignException.ServiceUnavailable</code> exception, the process is stopped temporally by throwing <code>NonRetryableExecutorException</code> with <code>FeignException.ServiceUnavailable</code> that occurred.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="saga_exception_annotation">@SagaException Annotation </h3>
<div class="paragraph">
<p>If you want to throw an exception as a <a href="#non_retryable_executor_exception">NonRetryableExecutorException</a>, The framework suggests you to create a new exception for that by warping the real exception and specially that can be annotated with <code>@SagaException</code> annotation like below.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Make sure to don&#8217;t add the variables for exception metadata in your new exception class.
Keep the exception class clear.
Because, the framework does provide another way to provide the metadata in <a href="#stacksaga_exception_wrapping">NonRetryableExecutorException</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaException</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">UserInactiveException</span><span style="color:#710">&quot;</span></span>) //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UserInactiveException</span> <span style="color:#088;font-weight:bold">extends</span> <span style="color:#C00;font-weight:bold">RuntimeException</span> {
    <span style="color:#777">//for just throw an exception.</span>
    <span style="color:#088;font-weight:bold">public</span> UserInactiveException() {
    }

    <span style="color:#777">//for just throw an exception with message.</span>
    <span style="color:#088;font-weight:bold">public</span> UserInactiveException(<span style="color:#0a8;font-weight:bold">String</span> message) {
        <span style="color:#950">super</span>(message);
    }

    <span style="color:#777">//for wrapping the exception.</span>
    <span style="color:#088;font-weight:bold">public</span> UserInactiveException(<span style="color:#0a8;font-weight:bold">String</span> message, <span style="color:#0a8;font-weight:bold">Throwable</span> cause) {
        <span style="color:#950">super</span>(message, cause);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>According to the <a href="#usage_of_exceptions">usage of exceptions example</a>, you can see this exception is used to throw if the user is inactive.
And also if you think the package of the exception class will be changed in some cases in the future, you can set a fixed name for the exception.
By annotating <code>@SagaException</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At the first glance, you might think that there is no point in annotating by <code>@SagaException</code> when it is thrown.
However, it is important when it is used in the revert executions (revert execution of the <a href="#command_executor">command executors</a> or <a href="#revert_after_executor">revert after</a> or <a href="#revert_before_executor">revert before</a>).
As you know, the revert process goes through revert method of each and every <a href="#command_executor">command executors</a> that successfully executed in the past regarding the transaction.
Then you have to check what is the real exception that was thrown, and what is the metadata that you want to make the decisions.
As an example, just imagine that there is an event in the event-store to be executed.
While the event is in the event-store, a new version is released of the particular service.
And also the exception class has been moved to another package by mistake, or as a requirement.
But while then, the old event is trying to be invoked through the StackSaga engine with old data.
However, At this moment the exception class that caused the exception does not exist in the path when the exception was thrown initially.</p>
</div>
<div class="paragraph">
<p>you can use the following methods that <code>NonRetryableExecutorException</code> does provide for checking the exception in the revert process.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>getRealExceptionName()</code>: Get the name with the path of the exception class that was thrown.
(This name is provided by the framework when the exception is thrown).</p>
</li>
<li>
<p><code>getRealExceptionSimpleName()</code>: Get just the name of the exception class that was thrown.
(This name is provided by the framework when the exception is thrown).</p>
</li>
<li>
<p><code><strong>getRealSagaExceptionName()</strong></code>: Get the name that has been given with <code>@SagaException</code> annotation.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can get the <code>Real Saga Exception Name</code> only if you have annotated with <code>@SagaException</code> annotation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here you can see an example of how you can use <code>SagaException</code> in the revert process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">stock-management-service</span><span style="color:#710">&quot;</span></span>,
        liveCheck = <span style="color:#069">true</span>,
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">UpdateStockExecutor</span><span style="color:#710">&quot;</span></span>
)
<span style="color:#007">@AllArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">UpdateStockExecutor</span> <span style="color:#088;font-weight:bold">implements</span> CommandExecutor&lt;PlaceOrderAggregator&gt; {


    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManager
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {
        ...
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> doRevert(
            ProcessStack previousProcessStack,
            NonRetryableExecutorException realException,
            PlaceOrderAggregator finalAggregateState,
            RevertHintStore revertHintStore
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException {

        realException.getRealSagaExceptionName().ifPresent(realSagaExceptionName -&gt; {// <b class="conum">(1)</b>
            <span style="color:#080;font-weight:bold">if</span> (realSagaExceptionName.equals(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">UserInactiveException</span><span style="color:#710">&quot;</span></span>)) {// <b class="conum">(2)</b>
                // <b class="conum">(3)</b>
                realException.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reason</span><span style="color:#710">&quot;</span></span>).ifPresent(reason -&gt; {
                    <span style="color:#080;font-weight:bold">if</span> (reason.equalsIgnoreCase(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">BadRequest</span><span style="color:#710">&quot;</span></span>)) {
                        <span style="color:#777">//do the revert process</span>
                    }
                });
            }
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can get the <code>RealSagaExceptionName</code> by calling <code>getRealSagaExceptionName()</code> method.
And if you have annotated the exception class with <code>@SagaException</code> annotation when the exception was thrown, it will return a <code>Optional&lt;String&gt;</code> object with the name that has been mentioned in the <code>@SagaException</code> annotation.
Or otherwise, the object will be empty.</p>
</li>
<li>
<p>check the equality of Saga exception name with the exception that you want.</p>
</li>
<li>
<p>due to that, the exception is the exact same, you can get and check the metadata of the exception that you have given at the moment the exception was thrown.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="saga_revert_hint_store">RevertHintStore</h3>
<div class="paragraph">
<p><code>RevertHintStore</code> does provide you a map to put the data that the revert processes want.
After having a <a href="#non_retryable_executor_exception">NonRetryableExecutorException</a>, the engine will start the revert process by stopping to forward anymore.
You know already, when the transaction going forward, you can update or add the data in the aggregator object.
But when it is starting to revert, you cannot change the values in the aggregator object anymore.
Because the aggregator object is frozen.
Therefore, you should have to have a way to carry out the data to the backwards as well.
To overcome that problem, the system provides the RevertHintStore object to add your extra hints that are necessary for the revert process through each executor.
After adding the data in the <code>RevertHintStore</code> object, you can read that data from other next revert-processes.</p>
</div>
<div class="paragraph">
<p>Here you can see an implementation for revert method of one of command executors.
<code>RevertHintStore</code> can be used in all revert processes like <a href="#revert_before_executor">revert-before</a>,
<a href="#revert_after_executor">revert-after</a> executors as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutor</span>(
        executeFor = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">delivery-service</span><span style="color:#710">&quot;</span></span>,
        liveCheck = <span style="color:#069">true</span>,
        value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DispatchOrderExecutor</span><span style="color:#710">&quot;</span></span>
)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">DispatchOrderExecutor</span> <span style="color:#088;font-weight:bold">implements</span> CommandExecutor&lt;PlaceOrderAggregator&gt; {


    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ProcessStepManager&lt;PlaceOrderAggregator&gt; doProcess(
            ProcessStack processStack,
            PlaceOrderAggregator aggregator,
            ProcessStepManagerUtil&lt;PlaceOrderAggregator&gt; stepManager
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException, NonRetryableExecutorException {
        <span style="color:#777">//</span>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> doRevert(ProcessStack processStack,
                         NonRetryableExecutorException realException,
                         PlaceOrderAggregator aggregator,
                         RevertHintStore revertHintStore
    ) <span style="color:#088;font-weight:bold">throws</span> RetryableExecutorException {

        revertHintStore
                .get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MakePaymentExecutor</span><span style="color:#710">&quot;</span></span>) // <b class="conum">(1)</b>
                .ifPresent(makePaymentExecutor -&gt; {
                    <span style="color:#080;font-weight:bold">if</span> (makePaymentExecutor.equalsIgnoreCase(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">success</span><span style="color:#710">&quot;</span></span>)) {
                        // <b class="conum">(2)</b>
                        revertHintStore.put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">last_updated_time</span><span style="color:#710">&quot;</span></span>, LocalDateTime.now().toString());
                        // <b class="conum">(2)</b>
                        revertHintStore.put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DispatchOrderExecutor</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">success</span><span style="color:#710">&quot;</span></span>);
                    }
                });
        ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Obtaining the <code>RevertHintStore</code> data (Key: MakePaymentExecutor) that have been added in another revert process before.
If the value exists in the <code>RevertHintStore</code> you will have an <code>Optional&lt;String&gt;</code> object with the data.</p>
</li>
<li>
<p>Based on the <code>RevertHintStore</code> 's old data that bes been added by another executor, adding another data into the <code>RevertHintStore</code>.
This value will be helpful for the next revert process.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="saga_event_handler">Saga Execution Event Listener </h3>
<div class="paragraph">
<p><code>SagaExecutionEventListener</code> is the place where you&#8217;re notified about each and every action during the process by the SEC.
As an example, you hand over your transaction to the StackSaga engine by mentioning the starting executor.
After handing over, the engine will invoke your executors one by one.
During the process, the engine does provide some events regarding the execution to notify.
To get notified, you can create a separate EventListener classes for each and every <a href="#creating_aggregator_class">Aggregator</a>.
For creating the EventListeners, the EventListeners should be implemented from <code>ExecutionEventListener&lt;A&gt;</code> interface.
<code>A</code> is the Aggregator class that you want to get notified.
And also the class should be annotated with <code><strong>@SagaExecutionEventListener</strong></code>  or <code>@<strong>SagaAsyncExecutionEventListener</strong></code>.
Those annotations provide Spring bean capabilities for your implementation as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you want to call the event methods in <strong>Async-mode</strong>  inside the handler, the handler class can be annotated with <code>@SagaAsyncExecutionEventListener</code> instead of <code>@SagaExecutionEventListener</code>.
Then it will run the event methods in separate threads asynchronously.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to not use spring <code>@Async</code> annotation with each method inside the listener or the entire class.
Because StackSaga does create a separate thread pool for executing the event methods and also, you can customize it as per the requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ExecutionEventListener&lt;A&gt;</code> provides the following events to be notified.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code><strong>onEachProcessPerformed</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>This method will be invoked after executing each sub process successfully.
— Just think about our example.
After payment process success, the order status should be updated as payment successful and also after successfully dispatched the order, the order status should be updated as order dispatched.
And just think, you want to update your customer by sending an email after the payment process and after dispatching the process.
Handler is the place that you can invoke your processes.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>onEachRevertPerformed</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>This is the opposite of the onEachProcess.
That works after every successful process.
If the whole transaction has to be reverted at some point, the compensation process starts from that point.
Then the revert method of each executed executor starts to be executed as the compensations.
If you want to get notified after each compensation, onEachRevert method will be invoked by the framework with all the data that you want.<br>
According to the example, if the payment process is failed, you have to update the order status as payment failed.
This kind of execution can be proceeded in this method.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>onTransactionCompleted</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>There are two meanings of transaction-complete.
One is that the transaction was processed without any process exception.
When considering the example the create-order success, user checking is successful, make payment is success, increase point is success, and finally dispatching the order is also success.
The 2nd success is, a process exception was happened and after that all the relevant compensation has been processed successfully.
(That means a revert error hasn&#8217;t been occurred while the compensation process) otherwise we can say the compensation has been processed smoothly without any exceptions.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>onProcessException</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>This is not relevant to the sub process.
That means the process exception can be happened only one time in the entire process.
When considering the example, you are going to dispatch the order, and it is failed because of non-retryable exception.
(Just think the order is not existing in the database) then the compensation process will be started.
This is the turning point to compensation start.
At that time, this method will be invoked by the framework with the data that you want.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code><strong>onTransactionTerminated</strong></code></p>
<div class="ulist">
<ul>
<li>
<p>According to the flow, any revert process can&#8217;t have non-retryable exception.
That is the rule.
But sometimes the programmer may haven&#8217;t been handled that.
Then the revert process also can&#8217;t be processed anymore.
Then the framework marks that transaction as a garbage transaction and terminates the process.
This is a very rare case.
But it can be happened.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In <code>ExecutionEventListener</code>, all the abstract methods are default.
Therefore, you don&#8217;t want to override all the methods, and you can only override the methods that you want as per the requirement.
And also you can create multiple listeners for the target Aggregator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here you can see an example how you can create a listener of <code>ExecutionEventListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SagaExecutionEventListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderEventListener</span> <span style="color:#088;font-weight:bold">implements</span> ExecutionEventListener&lt;PlaceOrderAggregator&gt; {
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onEachProcessPerformed(<span style="color:#0a8;font-weight:bold">Class</span>&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaExecutor&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaAggregate&gt;&gt; processedExecutor, PlaceOrderAggregator currentAggregate) {
        <span style="color:#777">//do whatever you want</span>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onEachRevertPerformed(<span style="color:#0a8;font-weight:bold">Class</span>&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaExecutor&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaAggregate&gt;&gt; revertedExecutor, PlaceOrderAggregator finalAggregateState, NonRetryableExecutorException nonRetryableExecutorException, RevertHintStore revertHintStore) {
        <span style="color:#777">//do whatever you want</span>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onTransactionCompleted(TransactionCompletedDetail&lt;PlaceOrderAggregator&gt; transactionCompletedDetail, CompleteStatus completeStatus) {
        <span style="color:#777">//do whatever you want</span>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onTransactionTerminated(TransactionTerminationDetail&lt;PlaceOrderAggregator&gt; transactionTerminationDetail) {
        <span style="color:#777">//do whatever you want</span>
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onProcessException(PlaceOrderAggregator finalAggregateState, NonRetryableExecutorException exception, <span style="color:#0a8;font-weight:bold">Class</span>&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaExecutor&lt;? <span style="color:#088;font-weight:bold">extends</span> SagaAggregate&gt;&gt; executorClass) {
        <span style="color:#777">//do whatever you want</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="saga_template">SagaTemplate&lt;A&gt;</h3>
<div class="paragraph">
<p><code>SagaTemplate</code> is the class which is responsible for starting the StackSaga engine to invoke your transaction.
By providing the necessary data, you can say to start the process of the transaction for StackSaga engine.
<code>SagaTemplate</code> is an instance, and it provides one method called <code>process(&#8230;&#8203;)</code> for starting the process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>SagaTemplate</code> Is a spring bean that you can Autowire (Injectable) in Spring environment.
You can autowire it by using spring @Autowire annotation or by creating the constructor.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RestController</span>
<span style="color:#007">@RequestMapping</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/order</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@AllArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PlaceOrderSagaController</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> SagaTemplate&lt;PlaceOrderAggregator&gt; sagaTemplate; //<b class="conum">(1)</b>

    <span style="color:#007">@PostMapping</span>
    <span style="color:#007">@ResponseStatus</span>(HttpStatus.ACCEPTED)
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; placeOrder() {
        //<b class="conum">(2)</b>
        PlaceOrderAggregator aggregator = <span style="color:#080;font-weight:bold">new</span> PlaceOrderAggregator();
        aggregator.setUsername(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mafei</span><span style="color:#710">&quot;</span></span>);
        aggregator.setTotal(<span style="color:#60E">200.00</span>);

        //<b class="conum">(3)</b>
        <span style="color:#950">this</span>.sagaTemplate.process(
                aggregator,
                CheckUserExecutor.class
        );
        //<b class="conum">(4)</b>
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#0a8;font-weight:bold">Collections</span>.singletonMap(
                <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">order_id</span><span style="color:#710">&quot;</span></span>,
                aggregator.getAggregateTransactionId()
        );
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Autowire(inject) the <code>SagaTemplate</code> by providing the target <a href="#creating_aggregator_class">Aggregator</a> Class.</p>
</li>
<li>
<p>Initialize your aggregator by providing the initial data.</p>
</li>
<li>
<p>Use the autowired <code>SagaTemplate</code> object and call the <code>process(..)</code> method.
As the first argument, you have to provide the initialized target aggregator object.
As the second argument you have to provide, which is the first executor that should be started the transaction.
According to the example, The 1st executor is <code>CheckUserExecutor.class</code>.
It can be either <a href="#command_executor">Command-Executor</a> or <a href="#query_executor">Query-Executor</a>.</p>
</li>
<li>
<p>Returns the response by obtaining the aggregatorTransactionId from the initialized object.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Due to the fact that the target aggregator class has been extended from the <code>SagaAggregate</code>, you can use inherited methods from <code>SagaAggregate</code> class. <code>getAggregateTransactionId()</code> method is one of inherited methods from <code>SagaAggregate</code> class.
It will provide you the <strong>unique ID</strong> for each object (each transaction) that you initialize.
It will be the transaction id for the entire transaction.
</td>
</tr>
</table>
</div>
<hr>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Even though <code>SagaTemplate&lt;A&gt;</code> can be autowired anywhere in the application, As the best practice it is recommended to use <code>SagaTemplate&lt;A&gt;</code> inside of an <code>EventHandler</code> class according to the StackSaga design pattern called <a href="#test">CHES</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="saga_trash_listener">TrashFileListener</h3>
<div class="paragraph">
<p><code>TrashFileListener</code> is used to be notified about the <strong>Trash-Files</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom_thread_pool_configuration">Custom Thread-pool configuration</h3>
<div class="paragraph">
<p>In StackSaga framework, there are several thread-pools are used behind the scene with default configurations.
All the executions are not executed with a single thread-pool to ensure the resiliency of the application.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Thread-pools in StackSaga framework</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">pool-name</th>
<th class="tableblock halign-left valign-top">Provider Interface</th>
<th class="tableblock halign-left valign-top">dependency</th>
<th class="tableblock halign-left valign-top">default-implementation</th>
<th class="tableblock halign-left valign-top">prefix</th>
<th class="tableblock halign-left valign-top">core pool size</th>
<th class="tableblock halign-left valign-top">max pool size</th>
<th class="tableblock halign-left valign-top">Queue Capacity</th>
<th class="tableblock halign-left valign-top">WaitOnShutdown</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#saga_discovery_transaction_task_executor"><code>SagaDiscoveryTransactionTaskExecutor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryTransactionTaskExecutorProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><code>stacksaga-spring-boot-starter-core</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryTransactionTaskExecutorProviderDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><strong>saga-tx-</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 1</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 3</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#saga_event_task_executor"><code>SagaEventTaskExecutor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaEventTaskExecutorProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><code>stacksaga-spring-boot-starter-core</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaEventExecutorProviderDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><strong>saga-event-</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 1</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 2</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#saga_admin_task_executor"><code>SagaAdminTaskExecutor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaAdminTaskExecutorProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><code>stacksaga-spring-boot-starter-discovery</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaAdminTaskExecutorProviderDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><strong>saga-admin-</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#saga_discovery_file_task_executor"><code>SagaDiscoveryFileTaskExecutor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryFileTaskExecutorProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><code>stacksaga-spring-boot-starter-discovery</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryFileTaskExecutorProviderDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><strong>saga-file-</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 1</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 2</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#saga_discovery_retry_transaction_task_executor"><code>SagaDiscoveryRetryTransactionTaskExecutor</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryRetryTransactionTaskExecutorProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><code>stacksaga-spring-boot-starter-discovery</code></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SagaDiscoveryRetryTransactionTaskExecutorProviderDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap"><strong>saga-R-tx-</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 1</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="nowrap">Available Processors * 2</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In case if you want to change the default configuration, you can do it by implementing following</p>
</div>
<div class="sect3">
<h4 id="saga_discovery_transaction_task_executor">Saga Discovery Transaction TaskExecutor</h4>
<div class="paragraph">
<p><code>SagaDiscoveryTransactionTaskExecutor</code> is the main pool. because this thread-pool is used for starting your transaction when it is called the <a href="#saga_template"><code>SagaTemplate.process()</code></a> method. after starting the transaction, this thread-pool will handle all the executions of the executors.</p>
</div>
<div class="paragraph">
<p>— In case if you want to customize the default configuration, you can update the default configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomSagaDiscoveryTransactionTaskExecutor</span>
    <span style="color:#088;font-weight:bold">implements</span> SagaDiscoveryTransactionTaskExecutorProvider { //<b class="conum">(2)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ThreadPoolTaskExecutor getTaskExecutor() {
        //<b class="conum">(3)</b>
        ThreadPoolTaskExecutor executor = <span style="color:#080;font-weight:bold">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span style="color:#0a8;font-weight:bold">Runtime</span>.getRuntime().availableProcessors() * <span style="color:#00D">5</span>);
        ...
        return executor;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mark the class as a spring <code>@Component</code> (bean).</p>
</li>
<li>
<p>Implement the custom task-executor provider class from <code>SagaDiscoveryTransactionTaskExecutorProvider</code> and override the <code>getTaskExecutor()</code> method.</p>
</li>
<li>
<p>Provide your custom task-executor configurations by creating a new instance of <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html"><code>ThreadPoolTaskExecutor</code></a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even though you change the prefix of the thread-pool when the task-executor is created, the prefix is restored for maintaining the thread-name uniqueness. <a href="#custom_thread_pool_configuration">See the prefix of each thread-pool</a>.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="saga_event_task_executor">Saga Event TaskExecutor</h4>
<div class="paragraph">
<p>— In case if you want to customize the default configuration, you can update the default configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomSagaEventTaskExecutor</span> <span style="color:#088;font-weight:bold">implements</span> SagaEventTaskExecutorProvider { //<b class="conum">(2)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ThreadPoolTaskExecutor getTaskExecutor() {
        // <b class="conum">(3)</b>
        ThreadPoolTaskExecutor executor = <span style="color:#080;font-weight:bold">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span style="color:#0a8;font-weight:bold">Runtime</span>.getRuntime().availableProcessors() * <span style="color:#00D">5</span>);
        ...
        return executor;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mark the class as a spring <code>@Component</code> (bean).</p>
</li>
<li>
<p>Implement the custom task-executor provider class from <code>SagaEventTaskExecutorProvider</code> and override the <code>getTaskExecutor()</code> method.</p>
</li>
<li>
<p>Provide your custom task-executor configurations by creating a new instance of <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html"><code>ThreadPoolTaskExecutor</code></a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even though you change the prefix of the thread-pool when the task-executor is created, the prefix is restored for maintaining the thread-name uniqueness. <a href="#custom_thread_pool_configuration">See the prefix of each thread-pool</a>.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="saga_admin_task_executor">Saga Admin TaskExecutor</h4>
<div class="paragraph">
<p>— In case if you want to customize the default configuration, you can update the default configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomSagaAdminTaskExecutor</span>
    <span style="color:#088;font-weight:bold">implements</span> SagaAdminTaskExecutorProvider {//<b class="conum">(2)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ThreadPoolTaskExecutor getTaskExecutor() {
        //<b class="conum">(3)</b>
        ThreadPoolTaskExecutor executor = <span style="color:#080;font-weight:bold">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span style="color:#0a8;font-weight:bold">Runtime</span>.getRuntime().availableProcessors() * <span style="color:#00D">5</span>);
        ...
        return executor;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mark the class as a spring <code>@Component</code> (bean).</p>
</li>
<li>
<p>Implement the custom task-executor provider class from <code>SagaAdminTaskExecutorProvider</code> and override the <code>getTaskExecutor()</code> method.</p>
</li>
<li>
<p>Provide your custom task-executor configurations by creating a new instance of <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html"><code>ThreadPoolTaskExecutor</code></a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even though you change the prefix of the thread-pool when the task-executor is created, the prefix is restored for maintaining the thread-name uniqueness. <a href="#custom_thread_pool_configuration">See the prefix of each thread-pool</a>.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="saga_discovery_file_task_executor">Saga Discovery File TaskExecutor</h4>
<div class="paragraph">
<p>— In case if you want to customize the default configuration, you can update the default configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomSagaDiscoveryFileTaskExecutor</span>
    <span style="color:#088;font-weight:bold">implements</span> SagaDiscoveryFileTaskExecutorProvider { //<b class="conum">(2)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ThreadPoolTaskExecutor getTaskExecutor() {
        //<b class="conum">(3)</b>
        ThreadPoolTaskExecutor executor = <span style="color:#080;font-weight:bold">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span style="color:#0a8;font-weight:bold">Runtime</span>.getRuntime().availableProcessors() * <span style="color:#00D">5</span>);
        ...
        return executor;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mark the class as a spring <code>@Component</code> (bean).</p>
</li>
<li>
<p>Implement the custom task-executor provider class from <code>SagaDiscoveryFileTaskExecutorProvider</code> and override the <code>getTaskExecutor()</code> method.</p>
</li>
<li>
<p>Provide your custom task-executor configurations by creating a new instance of <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html"><code>ThreadPoolTaskExecutor</code></a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even though you change the prefix of the thread-pool when the task-executor is created, the prefix is restored for maintaining the thread-name uniqueness. <a href="#custom_thread_pool_configuration">See the prefix of each thread-pool</a>.
</td>
</tr>
</table>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="saga_discovery_retry_transaction_task_executor">Saga Discovery Retry Transaction TaskExecutor</h4>
<div class="paragraph">
<p>Even though the transaction is started by the <a href="#saga_discovery_transaction_task_executor"><code>SagaDiscoveryTransactionTaskExecutor</code></a>
thread-pool, if the transaction is paused due a <a href="#retryable_executor_exception"><code>RetryableExecutorException</code></a>, the transaction should be retried again after some time (configured schedule).
For those executions, the <code>SagaDiscoveryRetryTransactionTaskExecutor</code> thread-pool is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It ensures the application&#8217;s resiliency.
And also the application can receive the new transaction without interrupting the transaction retry-bulk.
The summary is that the retry execution does not disturb to the brand-new transaction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>— In case if you want to customize the default configuration, you can update the default configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomSagaDiscoveryRetryTransactionTaskExecutor</span>
    <span style="color:#088;font-weight:bold">implements</span> SagaDiscoveryRetryTransactionTaskExecutorProvider {//<b class="conum">(2)</b>

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> ThreadPoolTaskExecutor getTaskExecutor() {
        //<b class="conum">(3)</b>
        ThreadPoolTaskExecutor executor = <span style="color:#080;font-weight:bold">new</span> ThreadPoolTaskExecutor();
        executor.setCorePoolSize(<span style="color:#0a8;font-weight:bold">Runtime</span>.getRuntime().availableProcessors() * <span style="color:#00D">5</span>);
        ...
        return executor;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Mark the class as a spring <code>@Component</code> (bean).</p>
</li>
<li>
<p>Implement the custom task-executor provider class from <code>SagaDiscoveryRetryTransactionTaskExecutorProvider</code> and override the <code>getTaskExecutor()</code> method.</p>
</li>
<li>
<p>Provide your custom task-executor configurations by creating a new instance of <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html"><code>ThreadPoolTaskExecutor</code></a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Even though you change the prefix of the thread-pool when the task-executor is created, the prefix is restored for maintaining the thread-name uniqueness. <a href="#custom_thread_pool_configuration">See the prefix of each thread-pool</a>.
</td>
</tr>
</table>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="custom_admin_connect_resttemplate_configuration">Custom Admin Connector configuration</h3>
<div class="paragraph">
<p>As per the architecture, all the StackSaga clients connect to the StackSaga admin server initially (<strong>for submitting the instance metadata</strong>) and as well as during the StackSaga-client is being run (<strong>for submitting the terminated transaction data</strong>).</p>
</div>
<div class="paragraph">
<p>IF you want to connect your service with the StackSaga admin server, you have to have a <strong>service-account</strong> that has been created by the StackSaga admin.
IF you have a <strong>service-account</strong>, you can provide your service-account username and password for the basic authentication purpose.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the microservice architecture, you will have hundreds of instances running on.
It is enough to have a one service-account for one service-name.
(The <code>spring.application.name</code> is considered as the service-name.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After creating the <code>service-account</code>, you will have the basic authentication for the registered service.
Those basic authentication can be provided as follows in the configuration property file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">stacksaga.connect.admin-url=http://localhost:4444
stacksaga.connect.admin-username=order-service
stacksaga.connect.admin-password=*****************</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to that, if you want to provide more complex configurations for the http client (RestTemplate) like enable custom SSL configurations, You can provide your own <code>RestTemplate</code> for the StackSaga framework to use when the client connects to the admin-server.
Then the default configuration (<code>SagaAdminConnectRestTemplateProviderDefault</code>) will be overridden with your custom configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Component</span> //<b class="conum">(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomAdminConnectRestTemplate</span> <span style="color:#088;font-weight:bold">implements</span> SagaAdminConnectRestTemplateProvider {//<b class="conum">(2)</b>
    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> RestTemplate getRestTemplate() {
        //<b class="conum">(3)</b>
        RestTemplate restTemplate = <span style="color:#080;font-weight:bold">new</span> RestTemplate();
        <span style="color:#777">//provide your custom configurations</span>
        <span style="color:#080;font-weight:bold">return</span> restTemplate;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Annotate the <code>CustomAdminConnectRestTemplate</code> class with spring <code>@Component</code> annotation.</p>
</li>
<li>
<p>Implement the custom RestTemplate provider class from <code>SagaAdminConnectRestTemplateProvider</code> and override the <code>getRestTemplate()</code> method.</p>
</li>
<li>
<p>Provide the custom RestTemplate with your own configurations.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Make sure to add the <code>rootUri</code> of the Admin-server to the new restTemplate
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="custom_service_communication_resttemplate_configuration">Custom Service Communication configuration</h3>

</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-26 00:35:00 +0530
</div>
</div>
</body>
</html>